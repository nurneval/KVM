{% extends "index.html" %}
{% block content %}
		
						<div class="row">
								<div class="col-xs-12">
									
									<div class="col-sm-offset-1 col-sm-10">
										<div class="well well-sm">
													<button type="button" class="close" data-dismiss="alert">&times;</button>
													&nbsp;
													<div class="inline middle blue bigger-110"> <i class="icon-spinner icon-spin orange bigger-150"></i>
													<strong>Task Scheduler Configuration Center</strong> </div>
	
													&nbsp; &nbsp; &nbsp;
													
												</div><!-- /well -->
										<div class="tabbable tabs-left">
											<ul class="nav nav-tabs" id="myTab3">
												
												<li class="active">
													<a data-toggle="tab" href="#info">
														<i class="green   icon-rocket bigger-110"></i>
														Task Tips
													</a>
												</li>										
												
												<li>
													<a data-toggle="tab" href="#vm">
														<i class="pink   icon-fire bigger-110"></i>
														Crontab scheduling
													</a>
												</li>

												<li >
													<a data-toggle="tab" href="#messages">
														<i class="orange  icon-bell bigger-110"></i>
														Interval scheduling
													</a>
												</li>
												<li >
													<a data-toggle="tab" href="#password">
														<i class="blue  icon-legal"></i>
														task list
													</a>
												</li>
												
											</ul>

											<div class="tab-content">
											
												<div id="info" class="tab-pane  in active">
												
																<ul class="list-unstyled spaced2">
																	<li>
																		<i class="icon-circle green"></i>
																		Get host information and status
																	</li>
										
																	<li >
																		<i class="icon-ok bigger-110 green"></i>
																		Get the host machine running virtual machine information and status
																	</li>
										
																		<li class="muted">
																			<i class="icon-warning-sign orange"></i>
																			Precautions for configuration:
																											
																		</li>
									
																		<li>
																			<ul class="list-unstyled">
																				<li>
																					<i class="icon-caret-right blue"></i>
																					Add task scheduling first<ins><strong>Crontab</strong></ins> or <ins><strong>Interval</strong></ins>
																				</li>
																				
																				<li>
																					<i class="icon-caret-right blue"></i>
																					<ins><strong>Crontab</strong></ins> Is a Linux-like Crontab-style scheduled task 
																				</li>
																				
																				<li>
																					<i class="icon-caret-right blue"></i>
																					Obtain<strong>Host machine</strong>Information and status: <ins><strong>tasks.updateVMserver</strong></ins>
																				</li>
																					
																				<li>
																					<i class="icon-caret-right blue"></i>
																					Obtain<strong>virtual machine</strong>Information and status: <ins><strong>tasks.updateVMinstance</strong></ins>
																				</li>
																				<li>
																					<i class="icon-caret-right blue"></i>
																					Synchronize<strong>My virtual machine</strong>Information and status: <ins><strong>tasks.checkVMinstance</strong></ins>
																				</li>																				
																				<li>
																					<i class="icon-caret-right blue"></i>
																					in case<ins><strong>tasks.updateVMinstance</strong></ins>Without parameters, it is to obtain<strong>All host instance states</strong>If too many host machines are recommended to pass the host<strong>IPAddress</strong>As a parameter.
																				</li>
																				<li>
																					<i class="icon-caret-right blue"></i>
																					use<ins><strong>tasks.updateVMinstance</strong></ins>, It is recommended that the interval is greater than 5 seconds.
																				</li>
									
																			</ul>
																		</li>																																																																																																											
																	</ul>														
																								
												</div>
											
												<div id="vm" class="tab-pane">
													<div class="widget-toolbox padding-8 clearfix">
		
														<button class="btn btn-xs btn-success pull-left" class="btn btn-primary btn-lg" data-toggle="modal"  data-target="#addCrontabModal">
															<i class="icon-arrow-right icon-plus"></i>
															<span class="bigger-110">Add scheduled tasks</span>
														</button>
													</div>												
													<div>
														<table class="table table-striped table-bordered">
															<thead>
																<tr>
																	<th class="center">No.</th>
																	<th class="center">Minute</th>
																	<th class="hidden-xs center">Time</th>
																	<th class="hidden-480 center">day</th>
																	<th class="center">week</th>
																	<th class="center">year</th>
																	<th class="center">operating</th>
																</tr>
															</thead>
										
															<tbody>
																{% for ds in crontabList %}
																<tr>
																	<td class="center">{{  ds.id }}</td>
																	<td class="center">
																		<a>{{ ds.minute }}</a>
																	</td>
																		<td class="hidden-xs center">
																			{{ ds.hour }}									
																	</td>
																	<td class="center">
																			{{ ds.day_of_week }}																		
																	</td>
																	<td class="center">
																		{{ ds.day_of_month }}											
																	</td>
																	<td class="center">
																		{{ ds.month_of_year }}											
																	</td>
																	<td class="center">
																		
																		<button class="btn btn-xs btn-danger" onclick="onBtnHandleCrontab(this,'{{ds.id}}','delCrontab')">
																			<i class="icon-trash  bigger-110 icon-only"></i>
																		</button>											
																	</td>
																</tr>
																{% endfor %}
															</tbody>
														</table>
													</div>													
													<div class="hr "></div>
										
													<div class="row">
														<div class="col-sm-5 pull-right">
															<h4 class="pull-right">
																Total:
																<span class="red">{{ crontabList|length }}</span>
															</h4>
														</div>
														<div class="col-sm-7 pull-left"> Summary information </div>
													</div>
													
												</div>
												
												<div id="messages" class="tab-pane">
													<div class="widget-toolbox padding-8 clearfix">
		
														<button class="btn btn-xs btn-success pull-left" class="btn btn-primary btn-lg" data-toggle="modal"  data-target="#addIntervalModal">
															<i class="icon-arrow-right icon-plus"></i>
															<span class="bigger-110">Add interval tasks</span>
														</button>
													</div>												
													<div>
														<table class="table table-striped table-bordered">
															<thead>
																<tr>
																	<th class="center">No.</th>
																	<th class="center">interval</th>
																	<th class="center">Types of</th>																
																	<th class="center">operating</th>
																</tr>
															</thead>
										
															<tbody>
																{% for ds in intervalList %}
																<tr>
																	<td class="center">{{  ds.id }}</td>
																	<td class="center">
																		<a>{{ ds.every }}</a>
																	</td>
																		<td class="hidden-xs center">
																			{{ ds.period }}									
																	</td>													
																	<td class="center">
																		
																		<button class="btn btn-xs btn-danger" onclick="onBtnHandleCrontab(this,'{{ds.id}}','delInterval')">
																			<i class="icon-trash  bigger-110 icon-only"></i>
																		</button>											
																	</td>
																</tr>
																{% endfor %}
															</tbody>
														</table>
													</div>													
													<div class="hr "></div>
										
													<div class="row">
														<div class="col-sm-5 pull-right">
															<h4 class="pull-right">
																Total:
																<span class="red">{{ intervalList|length }}</span>
															</h4>
														</div>
														<div class="col-sm-7 pull-left"> Summary information </div>
													</div>
												</div>

												<div id="password"  class="tab-pane">
													<div class="col-xs-12">
													<a href="#" data-toggle="modal"  data-target="#addTaskModal">
														<botton class="btn bt1n-small btn-primary no-border pull-right">
														<i class="icon-arrow-right icon-plus"></i>
																Task
														</botton>	
													</a>									
													
													
													<h3 class="header smaller lighter blue">
														<i class="icon-hand-right icon-animated-hand-pointer blue"></i>
														Task list
													</h3>
													<div class="table-header">
														All current tasks
														
													</div>
														<div class="table-responsive">
															<table id="sample-table-2" class="table table-striped table-bordered table-hover">
																<thead>
																	<tr>
																		<th>
																			<label>
																				<input type="checkbox" class="ace" />
																				<span class="lbl">mission name</span>
																			</label>
																		</th>
																		<th>Function name</th>
																		<th>parameter</th>
																		<th>Last run time</th>			
																		<th>
																			<i class="icon-time bigger-110"></i>
																			Number of runs
																		</th>			
																		<th>Status</th>			
																		<th>operating</th>
																	</tr>
																</thead>
				
																<tbody>
																{% for ds in taskList %}
																	<tr>
																		<td>
																			<label>
																				<input type="checkbox" class="ace" />
																				<span class="lbl"></span>
																			</label>
																			<a href="#" data-toggle="modal"  data-target="#addTaskEditModal-{{ds.id}}">
																				{{ ds.name }}
																			</a>
																		</td>
				
																		<td>
																			
																			
																				{{ ds.task }}
																			
																		</td>
																		<td>
																			{{ ds.args }}
																			</a>
																		</td>
																		<td>{{ ds.last_run_at|date:"Y/m/d H:i:s" }}</td>
																		<td>
																			<span class="badge badge-warning">
																				{{ ds.total_run_count }}
																			</span>
																		</td>
																		<td>
														                   	{% if ds.enabled == 1 %}
														                   		 <span class="label label-success arrowed">
																					activation
																				</span>													                   
														                   	{% else %}
														                   		 <span class="label label-danger arrowed">
																					freeze
																				</span>							                   		 
														                   	{% endif %}																
																			
																		</td>
				
																		<td>
																			
																			<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
																				
																				
																																																					
																					
																				<a class="blue" href="#" data-toggle="modal"  data-target="#addTaskEditModal-{{ds.id}}">
																					<i class="icon-edit bigger-120"></i>															
																				</a>																																							
																				 	
																				 																																																		
																				<a class="red" href="javascript:" onclick="delTask(this,{{ ds.id}},'{{ds.name}}','delTask')">
																					<i class="icon-trash  bigger-120"></i>
																				</a>
																				
																																																				
																			</div>
																													
													
																		</td>
				
																	</tr>
																{% endfor %}
																</tbody>
															</table>
														</div>
												</div>
												</div>
											</div>
										</div>
									</div>								
								</div>
							</div>


	
	{% for ds in taskList %}
		<!-- TaskEdit Modal -->
		<div class="modal fade" id="addTaskEditModal-{{ds.id}}" tabindex="-1" role="dialog" aria-labelledby="addTaskEditModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width:800px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="addTaskEditModalLabel">
							Edit task
						</h4>
					</div>
					<div class="modal-body">
						
						<form class="form-horizontal" id="editTask-{{ds.id}}">
														
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Task name*</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="{{ds.name}}" placeholder="Update host xxx" name="name" />																				
										</div>
								</div>

								
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Task name*</strong></label>
							
											<div class="col-sm-9">
											<input  type="text"   value="{{ds.task}}" placeholder="Update host xxx" name="task" disabled/>																				
										</div>
								</div>
																	

								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Plan type</strong></label>
											<div class="col-sm-9">
												<select name="crontab">
													<option value="">Choose a schedule task</option>
													{% for cron in crontabList %}
														{% if ds.crontab_id == cron.id %}
															<option selected="selected" value="{{cron.id}}">{{cron.minute}}&nbsp;{{cron.hour}}&nbsp;{{cron.day_of_week}}&nbsp;{{cron.day_of_month}}&nbsp;{{cron.month_of_year}}</option>
														{% else %}
															<option value="{{cron.id}}">{{cron.minute}}&nbsp;{{cron.hour}}&nbsp;{{cron.day_of_week}}&nbsp;{{cron.day_of_month}}&nbsp;{{cron.month_of_year}}</option>
														{% endif %}
													{% endfor %}																																								
												</select>											
											<div class="space-2"></div>									
										</div>
								</div>

								
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Interval type</strong></label>
											<div class="col-sm-9">
												<select name="interval">
													<option value="">Select a gap type</option>
													{% for inter in intervalList %}
														{% if ds.interval_id == inter.id %}
															<option   selected="selected" value="{{inter.id}}">{{inter.every}}&nbsp;{{inter.period}}</option>
														{% else %}
															<option value="{{inter.id}}">{{inter.every}}&nbsp;{{inter.period}}</option>
														{% endif %}
													{% endfor %}																																								
												</select>											
											<div class="space-2"></div>									
										</div>
								</div>

								
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>parameter list</strong></label>
							
											<div class="col-sm-9">
												<input class="input-sm" type="text"   value="{{ds.args}}" placeholder='["192.168.1.233"]' name="args" />																														
										</div>
								</div>							
										
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Parameter dictionary</strong></label>							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="{{ds.kwargs}}" placeholder='{"key":"value"}' name="kwargs" />																												
										</div>
								</div>
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>queue</strong></label>
							
											<div class="col-sm-9">
											{% if ds.queue %}
												<input class="input-sm" type="text"   value="{{ds.queue}}" placeholder="Queue Name" name="queue" />		
											{% else %}	
												<input class="input-sm" type="text"   value="" placeholder="Queue Name" name="queue" />	
											{% endif %}																			
										</div>
								</div>	
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Expiration</strong></label>							
										<div class="col-sm-9">
											{% if ds.expires %}
												<input class="input-sm" type="text"   value="{{ds.expires}}" placeholder="2017-01-10 00:00:01" name="expires" />		
											{% else %}
												<input class="input-sm" type="text"   value="" placeholder="2017-01-10 00:00:01" name="expires" />
											{% endif %}																			
										</div>																				
										
								</div>	
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>ActivateNow</strong></label>
							

										<div class="col-sm-9">
											<select name="enabled">
													{% if ds.enabled == 1 %}
													<option selected="selected" value="1">activation</option>
													<option value="0">freeze</option>
													{% else %}
													<option  value="1">activation</option>
													<option selected="selected" value="0">freeze</option>
													{% endif %}																																								
											</select>																				
										</div>																				
										
								</div>				
																		
						</form>	
						
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">close
						</button>
						<button type="button" class="btn btn-primary" onclick="editTask(this,{{ds.id}},'editTask')">
							save
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
	{% endfor %}


	<!-- CrontabModal Box -->
		<div class="modal fade" id="addCrontabModal" tabindex="-1" role="dialog" aria-labelledby="addCrontabModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="addCrontabModalLabel">
							Add Crontab Scheduling
						</h4>
					</div>
					<div class="modal-body">
						
						<form class="form-horizontal" id="addCrontab">
														
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Minute</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="*/5" placeholder="*/5" name="minute" />																				
										</div>
								</div>

								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Time</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="*" placeholder="*" name="hour" />																				
										</div>
								</div>	
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>week</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="*" placeholder="*" name="day_of_week" />																				
										</div>
								</div>	
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>month</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="*" placeholder="*" name="day_of_month" />																				
										</div>
								</div>							
										
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>year</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="*" placeholder="*" name="month_of_year" />																				
										</div>
								</div>						
																		
						</form>	
						
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">close
						</button>
						<button type="button" class="btn btn-primary" onclick="addCrontab(this,'addCrontab')">
							Add to
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>


<!-- Interval Modal -->
		<div class="modal fade" id="addIntervalModal" tabindex="-1" role="dialog" aria-labelledby="addIntervalModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="addIntervalModalLabel">
							Add Interval Scheduling
						</h4>
					</div>
					<div class="modal-body">
						
						<form class="form-horizontal" id="addInterval">
														
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>interval</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="5" placeholder="*" name="every" />																				
										</div>
								</div>

								<div class="form-group"> 
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Types of</strong></label>
							
										<div class="col-sm-9">
											<select name="period">
												<option value="seconds" selected="selected">second</option>
												<option value="minutes">minute</option>
												<option value="hours">hour</option>
												<option value="days">day</option>	
												<option value="microseconds">millisecond</option>																												
											</select>	
										</div>
								</div>	
														
																		
						</form>	
						
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">close
						</button>
						<button type="button" class="btn btn-primary" onclick="addInterval(this,'addInterval')">
							Add to
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		
		
	<!-- TaskModal Box -->
		<div class="modal fade" id="addTaskModal" tabindex="-1" role="dialog" aria-labelledby="addTaskModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width:800px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="addTaskModalLabel">
							Add task
						</h4>
					</div>
					<div class="modal-body">
						
						<form class="form-horizontal" id="addTask">
														
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Task name*</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="" placeholder="Update host xxx" name="name" />																				
										</div>
								</div>

								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>task*</strong></label>
							
										<div class="col-sm-9">
											<select name="task">
												<option value="">Choose a task</option>
												{% for ds in regTaskList %}
													<option value="{{ds}}">{{ds}}</option>
												{% endfor %}																																								
											</select>	
										</div>
								</div>	
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Schedule type*</strong></label>
							
										<div class="col-sm-9">
											<select id="schetype" onchange="javascript:oBtTaskTypeSelect();">
												<option value="">Choose a type</option>
													<option value="select_crontab">Crontab</option>
													<option value="select_nterval">Interval</option>																																								
											</select>	
										</div>																				
										
								</div>	
								
								<div class="form-group" style="display: none;" id="div_crontab">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Plan type*</strong></label>
											<div class="col-sm-9">
												<select name="crontab">
													<option value="">Choose a schedule task</option>
													{% for ds in crontabList %}
														<option value="{{ds.id}}">{{ds.minute}}&nbsp;{{ds.hour}}&nbsp;{{ds.day_of_week}}&nbsp;{{ds.day_of_month}}&nbsp;{{ds.month_of_year}}</option>
													{% endfor %}																																								
												</select>											
											<div class="space-2"></div>									
										</div>
								</div>
								
								<div class="form-group" style="display: none;" id="div_interval">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Interval type*</strong></label>
											<div class="col-sm-9">
												<select name="interval">
													<option value="">Select a gap type</option>
													{% for ds in intervalList %}
														<option value="{{ds.id}}">{{ds.every}}&nbsp;{{ds.period}}</option>
													{% endfor %}																																								
												</select>											
											<div class="space-2"></div>									
										</div>
								</div>
								
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>parameter list</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="" placeholder="['192.168.1.233']" name="args" />																				
										</div>
								</div>							
										
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Parameter dictionary</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="" placeholder="{'key':'value'}" name="kwargs" />																				
										</div>
								</div>
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>queue</strong></label>
							
											<div class="col-sm-9">
											<input class="input-sm" type="text"   value="" placeholder="Queue Name" name="queue" />																				
										</div>
								</div>	
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>Expiration</strong></label>
							

										<div class="col-sm-9">
											<input class="input-sm" type="text"   value="" placeholder="2017-01-10 00:00:01" name="expires" />																				
										</div>																				
										
								</div>	
								<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-4"><strong>ActivateNow</strong></label>
							

										<div class="col-sm-9">
											<select name="enabled">
													<option selected="selected" value="1">activation</option>
													<option value="0">freeze</option>																																								
											</select>																				
										</div>																				
										
								</div>				
																		
						</form>	
						
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">close
						</button>
						<button type="button" class="btn btn-primary" onclick="addTask(this,'addTask')">
							Add to
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
	
	<script src="/static/js/jquery.dataTables.min.js"></script>
	<script src="/static/js/jquery.dataTables.bootstrap.js"></script>
	
	<script type="text/javascript">
	
	jQuery(function($) {
		var oTable1 = $('#sample-table-2').dataTable( {
		"aoColumns": [
	      { "bSortable": false },
	      null, null,null, null, null,
		  { "bSortable": false }
		] } );
		
		
		$('table th input:checkbox').on('click' , function(){
			var that = this;
			$(this).closest('table').find('tr > td:first-child input:checkbox')
			.each(function(){
				this.checked = that.checked;
				$(this).closest('tr').toggleClass('selected');
			});
				
		});
	
	
		$('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
		function tooltip_placement(context, source) {
			var $source = $(source);
			var $parent = $source.closest('table')
			var off1 = $parent.offset();
			var w1 = $parent.width();
	
			var off2 = $source.offset();
			var w2 = $source.width();
	
			if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
			return 'left';
		}
	})
	
	addTaskrequired = ['name','task']; /* Required list */
	function oBtTaskTypeSelect() {
			   var obj = document.getElementById("schetype"); 
			   var index = obj.selectedIndex;
			   var value = obj.options[index].value; 
			   if (value=="select_crontab"){
				   addTaskrequired = ['name','task',"crontab"]; /* Required list */
				   document.getElementById("div_interval").style.display="none";
				   document.getElementById("div_crontab").style.display="";
			   }
			   else if (value=="select_nterval"){
				   addTaskrequired = ['name','task',"interval"]; /* Required list */
				   document.getElementById("div_interval").style.display="";
				   document.getElementById("div_crontab").style.display="none";
			   }			   
		   }
	
				function addCrontab(obj,op) {	
					var btnObj = $(obj);
					btnObj.attr('disabled',true);
						var server_data = {};
						var required = ['minute','hour',"day_of_week","day_of_month","month_of_year"]; /* Required list */
						var form = document.getElementById('addCrontab');
						for (var i = 0; i < form.length; ++i) {
							var name = form[i].name;
							var value = form[i].value;	
							idx = $.inArray(name, required);						
							if (idx >= 0 && value.length == 0){
								window.wxc.xcConfirm("Please note that required fields cannot be empty~", window.wxc.xcConfirm.typeEnum.error);
								btnObj.removeAttr('disabled');
								return false;
							};	
							if (  value.length != 0 && name.length != 0 ){
								server_data[name] = value;
							};					
						};				
						server_data['op'] = op
						$.ajax({
							dataType: "JSON",
							url:'/configTask/', //Request address
							type:"POST",  //Submit similar
							data:server_data,  //Submit parameters
							success:function(response){
								btnObj.removeAttr('disabled');
								if (response["code"] == 200){
									window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
								}
								else {
									window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
								}
								
							},
					    	error:function(response){
					    		btnObj.removeAttr('disabled');
					    		window.wxc.xcConfirm(response["data"], window.wxc.xcConfirm.typeEnum.error);
					    	}
						});	
					}
				
				function addInterval(obj,op) {	
					var btnObj = $(obj);
					btnObj.attr('disabled',true);
						var server_data = {};
						var required = ['every']; /* Required list */
						var form = document.getElementById('addInterval');
						for (var i = 0; i < form.length; ++i) {
							var name = form[i].name;
							var value = form[i].value;	
							idx = $.inArray(name, required);						
							if (idx >= 0 && value.length == 0){
								window.wxc.xcConfirm("Please note that required fields cannot be empty~", window.wxc.xcConfirm.typeEnum.error);
								btnObj.removeAttr('disabled');
								return false;
							};	
							if (  value.length != 0 && name.length != 0 ){
								server_data[name] = value;
							};					
						};				
						server_data['op'] = op
						$.ajax({
							dataType: "JSON",
							url:'/configTask/', //Request address
							type:"POST",  //Submit similar
							data:server_data,  //Submit parameters
							success:function(response){
								btnObj.removeAttr('disabled');
								if (response["code"] == 200){
									window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
								}
								else {
									window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
								}
								
							},
					    	error:function(response){
					    		btnObj.removeAttr('disabled');
					    		window.wxc.xcConfirm(response["data"], window.wxc.xcConfirm.typeEnum.error);
					    	}
						});	
					}
				
				function onBtnHandleCrontab(obj,id,op){
					var btnObj = $(obj);
					var txt=  "Are you sure to delete?";		
					var option = {
							title: "delete("+id+")",
							btn: parseInt("0011",2),
							onOk: function(){
								$.ajax({
									  type: 'POST',
									  url: '/configTask/',
									  data:{
											"id":id,
											"op":op,
										},
								      success:function(response){			            
							                if (response["code"]=="200"){ 
							                	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
		
							                }
								        	else{
								        		window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
								        	}						                
									},
						            error:function(response){
						            	window.wxc.xcConfirm("operation failed", window.wxc.xcConfirm.typeEnum.error);
						            },		
									});
							},
							onCancel:function(){	
							},
							onClose:function(){
							}
						}			
					window.wxc.xcConfirm(txt, "custom", option);
			}
				
				
				function addTask(obj,op) {	
					var btnObj = $(obj);
					btnObj.attr('disabled',true);
						var server_data = {};
						var form = document.getElementById('addTask');
						for (var i = 0; i < form.length; ++i) {
							var name = form[i].name;
							var value = form[i].value;	
							idx = $.inArray(name, addTaskrequired);						
							if (idx >= 0 && value.length == 0){
								window.wxc.xcConfirm("Please note that required fields cannot be empty~", window.wxc.xcConfirm.typeEnum.error);
								btnObj.removeAttr('disabled');
								return false;
							};	
							if (  value.length != 0 && name.length != 0 ){
								server_data[name] = value;
							};					
						};				
						server_data['op'] = op
						$.ajax({
							dataType: "JSON",
							url:'/configTask/', //Request address
							type:"POST",  //Submit similar
							data:server_data,  //Submit parameters
							success:function(response){
								btnObj.removeAttr('disabled');
								if (response["code"] == 200){
									window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
								}
								else {
									window.wxc.xcConfirm(response["data"], window.wxc.xcConfirm.typeEnum.error);
								}
								
							},
					    	error:function(response){
					    		btnObj.removeAttr('disabled');
					    		window.wxc.xcConfirm(response["data"], window.wxc.xcConfirm.typeEnum.error);
					    	}
						});	
					}
				
				function editTask(obj,id,op) {	
					var btnObj = $(obj);
					btnObj.attr('disabled',true);
						var server_data = {};
						var required = ['name','task'];
						var form = document.getElementById('editTask-'+id);
						for (var i = 0; i < form.length; ++i) {
							var name = form[i].name;
							var value = form[i].value;	
							idx = $.inArray(name,required);						
							if (idx >= 0 && value.length == 0){
								window.wxc.xcConfirm("Please note that required fields cannot be empty~", window.wxc.xcConfirm.typeEnum.error);
								btnObj.removeAttr('disabled');
								return false;
							};	
							if (  value.length != 0 && name.length != 0 ){
								server_data[name] = value;
							};					
						};				
						server_data['op'] = op;
						server_data['id'] = id;
						if (server_data.hasOwnProperty('crontab') && server_data.hasOwnProperty('interval')){
							window.wxc.xcConfirm("Interval type and schedule type cannot be applied to Task at the same time", window.wxc.xcConfirm.typeEnum.error);
							btnObj.removeAttr('disabled');
							return false;
						}
						$.ajax({
							dataType: "JSON",
							url:'/configTask/', //Request address
							type:"POST",  //Submit similar
							data:server_data,  //Submit parameters
							success:function(response){
								btnObj.removeAttr('disabled');
								if (response["code"] == 200){
									window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
								}
								else {
									window.wxc.xcConfirm(response["data"], window.wxc.xcConfirm.typeEnum.error);
								}
								
							},
					    	error:function(response){
					    		btnObj.removeAttr('disabled');
					    		window.wxc.xcConfirm(response["data"], window.wxc.xcConfirm.typeEnum.error);
					    	}
						});	
					}
				
				
				function delTask(obj,id,name,op){
					var btnObj = $(obj);
					if ( op == 'delTask'){
						var txt=  "Are you sure to delete?"
					}
					else if ( op == 'shutdown'){
						var txt=  "Is it closed?"
					};				
					var option = {
							title: "delete("+name+")",
							btn: parseInt("0011",2),
							onOk: function(){
								$.ajax({
									  type: 'POST',
									  url: '/configTask/',
									  data:{
											"id":id,
											"op":op,
										},
								      success:function(response){			            
							                if (response["code"]=="200"){ 
							                	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
		
							                }
								        	else{
								        		window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
								        	}						                
									},
						            error:function(response){
						            	window.wxc.xcConfirm("operation failed", window.wxc.xcConfirm.typeEnum.error);
						            },		
									});
							},
							onCancel:function(){	
							},
							onClose:function(){
							}
						}			
					window.wxc.xcConfirm(txt, "custom", option);
			}
				
		</script>

{% endblock %}
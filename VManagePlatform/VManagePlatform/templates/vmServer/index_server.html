<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Virtualization management platform</title>
		<meta name="keywords" content="虚拟化,管理" />
		<meta name="description" content="Virtualization,management,KVM" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	    <script src="/static/js/jquery-1.11.1.min.js"></script>
	    <script src="/static/js/jquery.form.js"></script>
	    <script src="/static/js/jquery.easy-pie-chart.min.js"></script>
		<!-- basic styles -->
		<link href="/static/css/bootstrap.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="/static/css/font-awesome.min.css" />
		<!--   csrf -->
		<script src="/static/js/csrf.js"></script>
		<!--    Popup style -->
   		<script src="/static/js/xcConfirm.js" type="text/javascript" charset="utf-8"></script>
   		<link rel="stylesheet" type="text/css" href="/static/css/xcConfirm.css"/>
		<script src="/static/js/echarts.js"></script>
		<!--[if IE 7]>
		  <link rel="stylesheet" href="/static/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!-- page specific plugin styles -->

		<!-- fonts -->

		<link rel="stylesheet" href="/static/css/jquery-ui-1.10.3.custom.min.css" />
		<link rel="stylesheet" href="/static/css/chosen.css" />
		<link rel="stylesheet" href="/static/css/datepicker.css" />
		<link rel="stylesheet" href="/static/css/bootstrap-timepicker.css" />
		<link rel="stylesheet" href="/static/css/daterangepicker.css" />
		<link rel="stylesheet" href="/static/css/colorpicker.css" />

		<!-- ace styles -->

		<link rel="stylesheet" href="/static/css/ace.min.css" />
		<link rel="stylesheet" href="/static/css/ace-rtl.min.css" />
		<link rel="stylesheet" href="/static/css/ace-skins.min.css" />

		<script src="/static/js/ace-extra.min.js"></script>

	</head>

	<body>

		<div class="navbar navbar-default" id="navbar">
			<script type="text/javascript">
				try{ace.settings.check('navbar' , 'fixed')}catch(e){}
			</script>

			<div class="navbar-container" id="navbar-container">
				<div class="navbar-header pull-left">
					<a href="#" class="navbar-brand">
						<small>
							<i class="icon-leaf"></i>
							Virtualization management platform
						</small>
					</a><!-- /.brand -->
				</div><!-- /.navbar-header -->

				<div class="navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav">

						<li class="green" id="logMsgs">
						</li>

						<li class="light-blue">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<img class="nav-user-photo" src="/static/avatars/user.jpg" alt="Jason's Photo" />
								<span class="user-info">
									<small>Welcome,</small>
									{{ user.username }}
								</span>

								<i class="icon-caret-down"></i>
							</a>

							<ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
								<li>
									<a href="/profile">
										<i class="icon-cog"></i>
										Settings
									</a>
								</li>

								<li>
									<a href="/profile">
										<i class="icon-user"></i>
										personal information
									</a>
								</li>

								<li class="divider"></li>

								<li>
									<a href="/logout">
										<i class="icon-off"></i>
										drop out
									</a>
								</li>
							</ul>
						</li>
					</ul><!-- /.ace-nav -->
				</div><!-- /.navbar-header -->
			</div><!-- /.container -->
		</div>

		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<div class="main-container-inner">
				<a class="menu-toggler" id="menu-toggler" href="#">
					<span class="menu-text"></span>
				</a>

				<div class="sidebar" id="sidebar">
					<script type="text/javascript">
						try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
					</script>

					<div class="sidebar-shortcuts" id="sidebar-shortcuts">
						<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
							<button class="btn btn-success">
								<i class="icon-signal"></i>
							</button>

							<button class="btn btn-info">
								<i class="icon-pencil"></i>
							</button>

							<button class="btn btn-warning">
								<i class="icon-group"></i>
							</button>

							<button class="btn btn-danger">
								<i class="icon-cogs"></i>
							</button>
						</div>

						<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
							<span class="btn btn-success"></span>

							<span class="btn btn-info"></span>

							<span class="btn btn-warning"></span>

							<span class="btn btn-danger"></span>
						</div>
					</div><!-- #sidebar-shortcuts -->

					<ul class="nav nav-list">
						<li class="active">
							<a href="/">
								<i class="icon-hand-left"></i>
								<span class="menu-text"> Return to the console </span>
							</a>
						</li>

						<li class="active open">
							<a href="#" class="dropdown-toggle">
								<i class="icon-desktop"></i>
								<span class="menu-text"> VM Manager </span><!-- Virtual Machine Manager  -->

								<b class="arrow icon-angle-down"></b>
							</a>

							<ul class="submenu">
								<li>
										<li>
											<a href="/viewServer/{{vmServer.id}}/">
												<i class="icon-leaf"></i>
												{{ vmServer.server_ip }}
											</a>
										</li>
								</li>

								<li>
							<ul class="submenu">
								</li>
							</ul>
						</li>
							</ul>

						</li>

						<li class="active open">
							<a href="#" class="dropdown-toggle">
								<i class=" icon-laptop"></i>
								<span class="menu-text"> VM instance </span><!-- Virtual machine instance -->
								<b class="arrow icon-angle-down"></b>
							</a>

							<ul class="submenu">

								<li>
									<a href="/listInstance/{{vmServer.id}}/">
										<i class="icon-double-angle-right"></i>
										Management instance
									</a>
								</li>
								<li>
									<a href="/addInstance/{{vmServer.id}}/">
										<i class="icon-double-angle-right"></i>
										Create an instance
									</a>
								</li>
							</ul>
						</li>

						<li>
							<a href="/listStorage/{{vmServer.id}}/" class="dropdown-toggle">
								<i class="icon-hdd"></i>
								<span class="menu-text"> Storage pool management</span>
							</a>
						</li>

						<li>
							<a href="/configNetwork/{{vmServer.id}}/" class="dropdown-toggle">
								<i class="icon-globe"></i>
								<span class="menu-text"> Network management</span>
							</a>
						</li>
					</ul><!-- /.nav-list -->

					<div class="sidebar-collapse" id="sidebar-collapse">
						<i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i>
					</div>

					<script type="text/javascript">
						try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
					</script>
				</div>

				<div class="main-content">
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

						<ul class="breadcrumb">
							{% for ds in localtion %}
								{% if forloop.counter == 1 %}
								<li>
									<i class="icon-home home-icon"></i>
									<a href="{{ ds.url }}">{{ ds.name }}</a>
								</li>
								{% else  %}
								<li>

									<a href="{{ ds.url }}">{{ ds.name }}</a>
								</li>
								{% endif %}
							{% endfor %}

						</ul><!-- .breadcrumb -->

						<div class="nav-search" id="nav-search">
							<form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="icon-search nav-search-icon"></i>
								</span>
							</form>
						</div><!-- #nav-search -->
					</div>

					<div class="page-content">
{% block content %}
	{% if vmServer %}

	<div class="row">
		<div class="col-xs-12">
			<h3 class="header smaller lighter blue">
			<i class="icon-hand-right icon-animated-hand-pointer blue"></i>
			{{ vmServer.name }} Details</h3>
			<div class="table-header"></div>
			<div class="tabbable">
				<ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab4">
					<li class="active">
						<a data-toggle="tab" href="#home4">Host machine</a>
					</li>

					<li>
						<a data-toggle="tab" href="#profile4">Storage pool</a>
					</li>

					<li>
						<a data-toggle="tab" href="#dropdown14">Instances</a>
					</li>
				</ul>

				<div class="tab-content">
						<div id="home4" class="tab-pane in active">


											<div class="profile-user-info profile-user-info-striped">
												<div class="profile-info-row">
													<div class="profile-info-name"> Hostname </div>

													<div class="profile-info-value">
														<span class="editable" >{{ vmServer.name }}</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> ManagementIP </div>

													<div class="profile-info-value">
														<i class="icon-map-marker light-orange bigger-110"></i>
														<span class="editable" >{{ vmServer.server_ip }}</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> CPU model </div>

													<div class="profile-info-value">
														<span class="editable" >{{ vmServer.cpu_model }}</span>
													</div>
												</div>

												<div class="profile-info-row" style="height: 60px;">
													<div class="profile-info-name"> CPU Frequency(mhz) </div>

													<div class="profile-info-value">
														<span class="editable" >{{ vmServer.cpu_mhz }}</span>
													</div>
												</div>

												<div class="profile-info-row" style="height: 60px;">
													<div class="profile-info-name"> The maximum number of CPUs </div>

													<div class="profile-info-value">
														<span class="editable" >{{ vmServer.cpu_total }}</span>
													</div>
												</div>

												<div class="profile-info-row" style="height: 60px;">
													<div class="profile-info-name"> Memory Capacity(GB) </div>

													<div class="profile-info-value">
														<span class="editable" >{{ vmServer.mem }}</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Memory usage </div>

													<div class="profile-info-value ">
														<span class="editable" >
															{% if vmServer.mem_per > 90  %}
																<div class="easy-pie-chart percentage" data-percent="{{ vmServer.mem_per }}" data-color="#D15B47">
																	<span class="percent">{{ vmServer.mem_per }}</span>%
																</div>
															{% elif 70 < vmServer.mem_per and vmServer.mem_per < 90 %}
																<div class="easy-pie-chart percentage" data-percent="{{ vmServer.mem_per }}" data-color="#87CEEB">
																	<span class="percent">{{ vmServer.mem_per }}</span>%
																</div>
															{% else %}
																<div class="easy-pie-chart percentage" data-percent="{{ vmServer.mem_per }}" data-color="#87B87F">
																	<span class="percent">{{ vmServer.mem_per }}</span>%
																</div>
															{% endif %}
														</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Instance </div>

													<div class="profile-info-value">
														<span class="editable badge badge-success">
															{{ vmServer.ins }}
														</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Status </div>

													<div class="profile-info-value">
														<span class="editable">
										                   	{% if vmServer.status == 0 %}
										                   		 <span class="label label-success arrowed">on</span>
										                   	{% else %}
										                   		 <span class="label label-danger arrowed-in">off</span>
										                   	{% endif %}
														</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> VMType</div>

													<div class="profile-info-value">
														<span class="editable">{{ vmServer.type }}</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Virtualized version</div>

													<div class="profile-info-value">
														<span class="editable">{{ vmServer.version }}</span>
													</div>
												</div>

											</div>


						</div>

						<div id="profile4" class="tab-pane">

							<div class="widget-toolbox padding-8 clearfix">

									<button class="btn btn-xs btn-success pull-left" data-toggle="modal" data-target="#addPoolModal">
										<i class="icon-arrow-right icon-plus"></i>
										<span class="bigger-110">Add a storage pool</span>
									</button>
							</div>

						     <table class="table table-bordered table-hover table-striped tablesorter">
						           <tbody>
							                <tr>
							                   	<td class="col-xs-1">
							                      <strong>Storage pool name	</strong>
							                	</td>
							                	<td >
								                  <strong>Capacity size(GB)	</strong>
							                	</td>
							                	<td >
								                  <strong>Available capacity(GB)	</strong>
							                	</td>
							                	<td class="center">
								                  <strong>Used	</strong>
							                	</td>
							                	<td>
								                  <strong>ActivateNow	</strong>
							                	</td>
							                	<td>
								                  <strong>Number of rolls	</strong>
							                	</td>
							                	<td class="center col-xs-1">
								                  <strong>operating	</strong>
							                	</td>
							                </tr>
						           		{% for ds in vmStorage %}
							                <tr>
							                	<td>
								                  {{ ds.pool_name }}
							                	</td>
							                	<td>
								                  {{ ds.pool_size }}
							                	</td>
							                	<td>
								                  {{ ds.pool_available }}
							                	</td>
							                	<td class="center col-xs-2">
																	<div class="progress  progress-striped" data-percent="{{ ds.pool_per }}%">
																		{% if ds.pool_per > 90  %}
																			<div class="progress-bar progress-bar-danger" style="width: {{ ds.pool_per }}%;"></div>
																		{% elif 70 < ds.pool_per and ds.pool_per < 90 %}
																			<div class="progress-bar progress-bar-yellow" style="width: {{ ds.pool_per }}%;"></div>
																		{% else %}
																			<div class="progress-bar progress-bar-success" style="width: {{ ds.pool_per }}%;"></div>
																		{% endif %}
																	</div>
							                	</td>

							                	<td>
								                   	{% if ds.pool_active == 1 %}
								                   		 <i class="icon-circle green"></i>
								                   	{% else %}
								                   		 <i class="text-warning bigger-110 orange"></i>
								                   	{% endif %}
							                	</td>

							                	<td>
								                  {{ ds.pool_volumes }}
							                	</td>

							                	<td class="center col-sm-2">
																	<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
																		<a class="black" href="/viewStorage/{{ vmServer.id }}/{{ ds.pool_name }}/">
																			<i class="icon-zoom-in  bigger-120"></i>
																		</a>
																		<a class="red" href="javascript:" onclick="onBtnHandleStorage(this,{{ vmServer.id }},'{{ vmServer.server_ip }}','{{ ds.pool_name }}','delete')">
																			<i class="icon-trash  bigger-120"></i>
																		</a>
																	</div>
							                	</td>
							                </tr>

						           		{% endfor %}

						           </tbody>
						      </table>
						</div>

						<div id="dropdown14" class="tab-pane">
							<div class="widget-toolbox padding-8 clearfix">

									<button class="btn btn-xs btn-success pull-left" onclick="window.location.href='/addInstance/{{vmServer.id}}/'">
										<i class="icon-arrow-right icon-plus"></i>
										<span class="bigger-110">Add an instance</span>
									</button>
							</div>

						     <table class="table table-bordered table-hover table-striped tablesorter">
						           <tbody>
							                <tr>
							                   	<td class="center">
							                      <strong>InstanceName	</strong>
							                	</td>
							                	<td class="center">
								                  <strong>CPUNumber	</strong>
							                	</td>
							                	<td class="center">
								                  <strong>MemoryCapacity(MB)	</strong>
							                	</td>
							                	<td>
								                  <strong>Memory usage</strong>
							                	</td>
							                	<td class="center">
								                  <strong>Disk information	</strong>
							                	</td>
							                	<td class="center">
								                  <strong> Network Interface	</strong>
							                	</td>
							                	<td class="center">
								                  <strong>VNCPort </strong>
							                	</td>
							                	<td class="center">
								                  <strong>ipAddress</strong>
							                	</td>
							                	<td class="center">
								                  <strong>Status	</strong>
							                	</td>
							                	<td>
								                  <strong>operating	</strong>
							                	</td>
							                </tr>
						           		{% for ds in vmInstance %}
							                <tr>
							                	<td class="center">
							                	<a href="/viewInstance/{{vmServer.id}}/{{ ds.name }}/">
								                  {{ ds.name }}
								                  </a>
							                	</td>


							                	<td class="center">
								                  {{ ds.cpu }}
							                	</td>


							                	<td class="center">
								                  {{ ds.mem }}
							                	</td>


							                	<td>
													<div class="progress  progress-striped" data-percent="{{ ds.mem_per }}%">
														{% if ds.mem_per > 90  %}
															<div class="progress-bar progress-bar-danger" style="width: {{ ds.mem_per }}%;"></div>
														{% elif 70 < ds.mem_per and ds.mem_per < 90 %}
															<div class="progress-bar progress-bar-yellow" style="width: {{ ds.mem_per }}%;"></div>
														{% else %}
															<div class="progress-bar progress-bar-success" style="width: {{ ds.mem_per }}%;"></div>
														{% endif %}
													</div>
							                	</td>

							                	<td class="center">
								                  {% for vd in ds.disk %}
								                  <a href="#" id="disk_details_{{ds.name}}_{{ forloop.counter }}" class="link-popover" rel="popover" tabindex="0" data-trigger="focus" data-content="
													<table class='table table-bordered'>
														<tr>
															<th>capacity</th>
															<td>{{ vd.disk_size }}</td>
														</tr>
														<tr>
															<th>Used space</th>
															<td>{{ vd.disk_capacity }}</td>
															</tr>
														<tr>
															<th>Device No</th>
															<td>{{vd.disk_sn}}</td>
														</tr>
														<tr>
															<th>Usage rate</th>
															<td>
																<div class='progress  progress-striped' data-percent='{{ vd.disk_per }}%'>

																	{% if vd.disk_per > 90 %}
																		<div class='progress-bar progress-bar-danger' style='width: {{ vd.disk_per }}%;'></div>
																	{% elif vd.disk_per > 70 and vd.disk_per < 90 %}
																		<div class='progress-bar progress-bar-yellow' style='width: {{ vd.disk_per }}%;'></div>
																	{% else %}
																		<div class='progress-bar progress-bar-success' style='width: {{ vd.disk_per }}%;'></div>
																	{% endif %}
																</div>
															</td>
														</tr>
														<tr>
															<th>Disk path</th>
															<td>{{ vd.disk_path}}</td>
														</tr>
														</table>
													" data-original-title="{{ vd.disk_sn }}Disk details">{{ vd.disk_sn }}</a>
													<br>
												 {% endfor %}
							                	</td>

							                	<td class="center">

							                	  {{ ds.netk }}

							                	</td>
							                	<td class="center">
								                  {{ ds.vnc }}
							                	</td>
							                	<td class="center">
								                	{% if ds.ip %}
									                  {% for i in ds.ip %}
									                  		{% for k,v in i.items %}
									                  			<strong>{{k}}:</strong> <code>{{v.addr}}/{{v.prefix}}</code>
									                  		{% endfor %}
									                  		<br>
									                  {% endfor %}
													{% else %}
	                                                    <code>Not found</code>
	                                                {% endif %}
							                	</td>
							                	<td class="center">
								                   	{% if ds.status == 1 %}
								                   		 <i class="icon-play green"></i>
								                   	{% elif ds.status == 3 %}
								                   		 <i class="icon-pause orange"></i>
								                   	{% elif ds.status == 5 %}
								                   		 <i class="icon-stop red"></i>
								                   	{% endif %}
							                	</td>


							                	<td>
													<div class="btn-group">
														<button data-toggle="dropdown" class="btn btn-inverse btn-sm dropdown-toggle">
															<i class="icon-wrench  bigger-110 icon-only"> </i>
															<span class="icon-caret-down icon-on-right"></span>
														</button>

														<ul class="dropdown-menu dropdown-info pull-right">
															<li>
																<a href="/vnc/{{ vmServer.id }}/{{ ds.vnc }}/{{ ds.token }}/" target="_black">
																<i class="icon-desktop bigger-120"></i>
																Console
																</a>
															</li>
															<li class="divider"></li>
															<li>
																<a  href="javascript:" onclick="onBtnHandleIns(this,{{ vmServer.id }},'{{ ds.name }}','start')">
																<i class="icon-headphones bigger-120"></i>
																start up
																</a>
															</li>

															<li>
																<a  href="javascript:" onclick="onBtnHandleIns(this,{{ vmServer.id }},'{{ ds.name }}','suspend')">
																<i class="icon-pause bigger-120"></i>
																time out
																</a>
															</li>
															<li>
																<a href="javascript:" onclick="onBtnHandleIns(this,{{ vmServer.id }},'{{ ds.name }}','resume')">
																<i class="icon-play bigger-120"></i>
																	restore
																</a>
															</li>
															<li>
																<a href="javascript:" onclick="onBtnHandleIns(this,{{ vmServer.id }},'{{ ds.name }}','reboot')">
																	<i class="icon-repeat bigger-120"></i>
																	Reboot
																</a>
															</li>
															<li>
																<a href="javascript:" onclick="onBtnHandleIns(this,{{ vmServer.id }},'{{ ds.name }}','shutdown')">
																	<i class="icon-stop bigger-120"></i>
																	shut down
																</a>
															</li>

															<li>

																<a  href="javascript:" onclick="onBtnHandleIns(this,{{ vmServer.id }},'{{ ds.name }}','halt')">
																	<i class="icon-off bigger-120"></i>
																	Forced shutdown
																</a>
															</li>
															<li class="divider"></li>
															<li>
																<a class="black" href="javascript:" onclick="snapshotInstance(this,{{ vmServer.id }},'{{ ds.name }}','add')">
																	<i class="icon-camera bigger-120"></i>
																	Create a snapshot
																</a>
															</li>

															<li class="divider"></li>
															<li>
																<a  href="javascript:" onclick="onBtnHandleIns(this,{{ vmServer.id }},'{{ ds.name }}','delete')">
																	<i class="icon-trash bigger-120"></i>
																	Remove host
																</a>
															</li>
														</ul>
													</div>
							                	</td>
							                </tr>

						           		{% endfor %}

						           </tbody>
						      </table>
						</div>
				</div>
			</div>
		</div>

	</div>

	<div class="row col-xs-12">

			<h3 class="header smaller lighter blue">
			<i class="icon-hand-right icon-animated-hand-pointer blue"></i>
			{{ vmServer.name }} The proportion of resources</h3>
			<div class="table-header"></div>

		<div class="col-xs-4 col-sm-4 widget-container-span">


			<div class="widget-box">
				<div class="widget-header widget-header-large">
					<h4>
						<i class="icon-dashboard"></i>
						InstanceStatus
					</h4>

					<div class="widget-toolbar">
						<a href="#" data-action="settings">
							<i class="icon-cog"></i>
						</a>

						<a href="#" data-action="reload">
							<i class="icon-refresh"></i>
						</a>

						<a href="#" data-action="collapse">
							<i class="icon-chevron-up"></i>
						</a>

						<a href="#" data-action="close">
							<i class="icon-remove"></i>
						</a>
					</div>
				</div>

			<div class="widget-body">
				<div class="widget-main">
					<div id="insView" style="height:400px"></div>
				</div>
				</div>
			</div>
		</div>

		<div class="col-xs-4 col-sm-4 widget-container-span">
			<div class="widget-box">
				<div class="widget-header widget-header-large">
					<h4>
						<i class="icon-dashboard"></i>
						CPU resource allocation
					</h4>

					<div class="widget-toolbar">
						<a href="#" data-action="settings">
							<i class="icon-cog"></i>
						</a>

						<a href="#" data-action="reload">
							<i class="icon-refresh"></i>
						</a>

						<a href="#" data-action="collapse">
							<i class="icon-chevron-up"></i>
						</a>

						<a href="#" data-action="close">
							<i class="icon-remove"></i>
						</a>
					</div>
				</div>

			<div class="widget-body">
				<div class="widget-main">
					<div id="cpuView" style="height:400px"></div>
				</div>
				</div>
			</div>
		</div>

		<div class="col-xs-4 col-sm-4 widget-container-span">
			<div class="widget-box">
				<div class="widget-header widget-header-large">
					<h4>
						<i class="icon-dashboard"></i>
						Memory resource allocation
					</h4>

					<div class="widget-toolbar">
						<a href="#" data-action="settings">
							<i class="icon-cog"></i>
						</a>

						<a href="#" data-action="reload">
							<i class="icon-refresh"></i>
						</a>

						<a href="#" data-action="collapse">
							<i class="icon-chevron-up"></i>
						</a>

						<a href="#" data-action="close">
							<i class="icon-remove"></i>
						</a>
					</div>
				</div>

			<div class="widget-body">
				<div class="widget-main">

					<div id="memView" style="height:400px"></div>
				</div>
				</div>
			</div>
		</div>
	</div>

<script type="text/javascript">

	jQuery(function($) {
	var oldie = /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());
	$('.easy-pie-chart.percentage').each(function(){
		$(this).easyPieChart({
			barColor: $(this).data('color'),
			trackColor: '#EEEEEE',
			scaleColor: false,
			lineCap: 'butt',
			lineWidth: 8,
			animate: oldie ? false : 1000,
			size:75
		}).css('color', $(this).data('color'));
	});

	});

{% for ds in vmInstance %}
	{% for vd in ds.disk %}
	$(function () {
		  var $flavor = $("#disk_details_{{ds.name}}_{{ forloop.counter }}");
		  if ( $flavor.popover ) {
		    $flavor.popover({html:true});
		  }
		});
	{% endfor %}
{% endfor %}

	   function onBtnHandleIns(obj, server_id,vm_name,op){
			var btnObj = $(obj);
			if ( op == 'start'){
				var txt=  "Is it sure to start?"
			}
			else if ( op == 'shutdown'){
				var txt=  "Is it closed?"
			}
			else if( op == 'resume' ){
				var txt=  "Do you confirm recovery?"
			}
			else if( op == 'suspend' ){
				var txt=  "Do you confirm the suspension?"
			}
			else if( op == 'halt' ){
				var txt=  "Is it mandatory to close?"
			}
			else if( op == 'reboot' ){
				var txt=  "Do you confirm the restart?"
			}
			else if( op == 'delete' ){
				var txt=  "Are you sure to delete?"
			};
			var option = {
					title: "Operation host("+vm_name+")",
					btn: parseInt("0011",2),
					onOk: function(){
						$.ajax({
							  type: 'POST',
							  url: '/handleInstance/'+server_id+'/',
							  data:{
									"server_id":server_id,
									"op":op,
									"vm_name":vm_name
								},
						      success:function(response){
					                if (response["code"]=="200"){
					                	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
					                	location.reload();
					                }
						        	else{
						        		window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
						        	}
							},
				            error:function(response){
				            	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
				            },
							});
					},
					onCancel:function(){
					},
					onClose:function(){
					}
				}
			window.wxc.xcConfirm(txt, "custom", option);
		}

		function snapshotInstance(obj,serverId,vmName,op){
			window.wxc.xcConfirm("please enter("+vmName+") Snapshot name:", window.wxc.xcConfirm.typeEnum.input,{
				onOk:function(result){
					if (result.length == 0){
						/* Exit without input string */
						return;
					};
					$.ajax({
						  type: 'POST',
						  url: '/handleSnapshot/{{vmServer.id}}/',
						  data: {
							  "server_id":serverId,
							  "op":op,
							  'vm_name':vmName,
							  'snap_name':result
						  },
					      success:function(response){
				                if (response["code"]=="200"){
				                	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);

				                }
					        	else{
					        		window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
					        	}
						},
			            error:function(response){
			            	window.wxc.xcConfirm("Request data error!", window.wxc.xcConfirm.typeEnum.error);
			            },
						});

				}
			});
	   }

	   function onBtnHandleStorage(obj, server_id,server_ip,pool_name,op){
			var btnObj = $(obj);
			if ( op == 'delete'){
				var txt=  "Are you sure to delete?"
			}
			else if ( op == 'disable'){
				var txt=  "Is it confirmed to be disabled?"
			};
			var option = {
					title: "Operation host("+server_ip+")",
					btn: parseInt("0011",2),
					onOk: function(){
						$.ajax({
							  type: 'POST',
							  url: '/handleStorage/{{vmServer.id}}/',
							  data:{
									"server_id":server_id,
									"op":op,
									"pool_name":pool_name
								},
						      success:function(response){
					                if (response["code"]=="200"){
					                	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);

					                }
						        	else{
						        		window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
						        	}
							},
				            error:function(response){
				            	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
				            },
							});
					},
					onCancel:function(){
					},
					onClose:function(){
					}
				}
			window.wxc.xcConfirm(txt, "custom", option);
		}

	   /* instance */
	   var myChart = echarts.init(document.getElementById('insView'));
			insOption  = {
				    title: {
				        x: 'center',
				        text: '{{vmServer.name}}',
				        subtext: 'Status',
				        /* link: 'http://echarts.baidu.com/doc/example.html' */
				    },
				    tooltip: {
				        trigger: 'item'
				    },
				    toolbox: {
				        show: true,
				        feature: {
				            dataView: {show: true, readOnly: false},
				            restore: {show: true},
				            saveAsImage: {show: true}
				        }
				    },
				    calculable: true,
				    grid: {
				        borderWidth: 0,
				        y: 80,
				        y2: 60
				    },
				    xAxis: [
				        {
				            type: 'category',
				            show: false,
				            data: [
				        		{% for k,v in vmServer.vmStatus.items %}
				        			'{{ k }}',
				        		{% endfor %}
				        	]
				        }
				    ],
				    yAxis: [
				        {
				            type: 'value',
				            show: false
				        }
				    ],
				    series: [
				        {
				            name: 'RunningInstanceStatus',
				            type: 'bar',
				            itemStyle: {
				                normal: {
				                    color: function(params) {
				                        // build a color map as your need.
				                        var colorList = [
				                          '#B5C334','#FCCE10','#E87C25','#27727B',
				                           '#FE8463','#9BCA63','#FAD860','#F3A43B','#60C0DD',
				                           '#D7504B','#C6E579','#F4E001','#F0805A','#26C0C0'
				                        ];
				                        return colorList[params.dataIndex]
				                    },
				                    label: {
				                        show: true,
				                        position: 'top',
				                        formatter: '{b}\n{c}'
				                    }
				                }
				            },
				            data: [
					        	{% for k,v in vmServer.vmStatus.items %}
				        			{{v|length}},
				        		{% endfor %}

				            ],
				            markPoint: {
				                tooltip: {
				                    trigger: 'item',
				                    backgroundColor: 'rgba(0,0,0,0)',
				                    formatter: function(params){
				                        return '<img src="'
				                                + params.data.symbol.replace('image://', '')
				                                + '"/>';
				                    }
				                },
				                data:
				                	[
							        	{% for k,v in vmServer.vmStatus.items %}
						        			 {xAxis:0, y: 350, name:'{{k}}', symbolSize:20, symbol: 'image://../static/asset/ico/折线图.png'},
						        		{% endfor %}

						            ]
				            }
				        }
				    ]
				};
       myChart.setOption(insOption);

	   /* cpu */
	   var myChart = echarts.init(document.getElementById('cpuView'));
	   cpuOption = {
			    title : {
			        text: '{{vmServer.name}}',
			        subtext: 'CPU',
			        x:'center'
			    },
			    tooltip : {
			        trigger: 'item',
			        formatter: "{a} <br/>{b} : {c} ({d}%)"
			    },
			    legend: {
			        orient : 'vertical',
			        x : 'left',
			        data:[{% for ds in vmInstance %}
			    			'{{ds.name}}',
			    		 {% endfor %}
			    		 ]
			    },
			    toolbox: {
			        show : true,
			        feature : {
			            mark : {show: true},
			            dataView : {show: true, readOnly: false},
			            magicType : {
			                show: true,
			                type: ['pie', 'funnel'],
			                option: {
			                    funnel: {
			                        x: '25%',
			                        width: '50%',
			                        funnelAlign: 'left',
			                        max: 1548
			                    }
			                }
			            },
			            restore : {show: true},
			            saveAsImage : {show: true}
			        }
			    },
			    calculable : true,
			    series : [
			        {
			            name:'cpuNumber',
			            type:'pie',
			            radius : '55%',
			            center: ['50%', '60%'],
			            data:[{% for ds in vmInstance %}
		    				{value:{{ds.cpu}}, name:'{{ds.name}}'},
			    		 {% endfor %}
			    		 ]
			        }
			    ]
			};

	   myChart.setOption(cpuOption);
	   /* RAM  */

	   var myChart = echarts.init(document.getElementById('memView'));
	   memOption = {
			    title : {
			        text: '{{vmServer.name}}',
			        subtext: 'Mem',
			        x:'center'
			    },
			    tooltip : {
			        trigger: 'item',
			        formatter: "{a} <br/>{b} : {c} ({d}%)"
			    },
			    legend: {
			        orient : 'vertical',
			        x : 'left',
			        data:[{% for ds in vmInstance %}
			    			'{{ds.name}}',
			    		 {% endfor %}
			    		 ]
			    },
			    toolbox: {
			        show : true,
			        feature : {
			            mark : {show: true},
			            dataView : {show: true, readOnly: false},
			            magicType : {
			                show: true,
			                type: ['pie', 'funnel'],
			                option: {
			                    funnel: {
			                        x: '25%',
			                        width: '50%',
			                        funnelAlign: 'left',
			                        max: 1548
			                    }
			                }
			            },
			            restore : {show: true},
			            saveAsImage : {show: true}
			        }
			    },
			    calculable : true,
			    series : [
			        {
			            name:'mem',
			            type:'pie',
			            radius : '55%',
			            center: ['50%', '60%'],
			            data:[{% for ds in vmInstance %}
		    				{value:{{ds.mem}}, name:'{{ds.name}}'},
			    		 {% endfor %}
			    		 ]
			        }
			    ]
			};


	   myChart.setOption(memOption);

</script>


	{% else %}


						<div class="error-container">
									<div class="well">
										<h1 class="grey lighter smaller">
											<span class="blue bigger-125">
												<i class="icon-sitemap"></i>
												404
											</span>
											Host link connection failed
										</h1>

										<hr />
										<h3 class="lighter smaller">Tried to link Libvirt remote server and found connection failed...</h3>

										<div>
											<form class="form-search">
												<span class="input-icon align-middle">
													<i class="icon-search"></i>

													<input type="text" class="search-query" placeholder="Give it a search..." />
												</span>
												<button class="btn btn-sm" onclick="return false;">Go!</button>
											</form>

											<div class="space"></div>
											<h4 class="smaller">Try to check the operation:</h4>

											<ul class="list-unstyled spaced inline bigger-110 margin-15">
												<li>
													<i class="icon-hand-right blue"></i>
													Libvirt has started
												</li>
												<li>
													<i class="icon-hand-right blue"></i>
													Libvirt remote configuration is correct
												</li>
												<li>
													<i class="icon-hand-right blue"></i>
													Libvirt is configured to allow remote access
												</li>

												<li>
													<i class="icon-hand-right blue"></i>
													Libvirt has open firewall ports
												</li>
											</ul>
										</div>

										<hr />
										<div class="space"></div>

										<div class="center">
											<a href="#" class="btn btn-grey">
												<i class="icon-arrow-left"></i>
												return
											</a>

											<a href="/listServer" class="btn btn-primary">
												<i class="icon-dashboard"></i>
												Homepage
											</a>
										</div>
									</div>
								</div>
	{% endif %}

									<div class="modal fade" id="addPoolModal" tabindex="-1" role="dialog" aria-labelledby="addPoolModalLabel" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
														&times;
													</button>
													<h4 class="modal-title" id="addPoolModalLabel">
														{{ vmServer.hostname }}Add a storage pool
													</h4>
												</div>
												<div class="modal-body">


													<form class="form-horizontal" role="form" id="addStroage">
														<div class="form-group">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-1">
																 <strong>
																 	Virtual Manager
																 </strong>
															</label>

															<div class="col-sm-9">
																<input class="input-sm" type="text"   value="{{ vmServer.server_ip }}" disabled/>
															</div>
															<div class="col-sm-9" style="display: none;">
																<input class="input-sm" type="text" name="pool_server"   value="{{ vmServer.id }}"/>
															</div>
														</div>

														<div class="form-group">
															<label class="col-sm-3 control-label no-padding-right" for="form-input-readonly"><strong> Types of</strong> </label>

															<div class="col-sm-9">
																<select id="pool_type" name="pool_type" onchange="javascript:oBtStorageTypeSelect();">
																	<option value="dir">DIR</option>
																	<option value="disk">DISK</option>
																	<option value="logical">LOGICAL</option>
																	<option value="nfs">NFS</option>
																	<option value="iscsi">iSCSI</option>
																	<option value="zfs">ZFS</option>
																	<option value="gluster">GLUSTER</option>
																</select>
															</div>
														</div>

														<div class="form-group">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>name</strong></label>

															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_name" placeholder="Name" value=""/>
																<div class="space-2"></div>
															</div>
														</div>
														<div class="form-group" style="display: none;" id="div_pool_host">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Host address</strong></label>
															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_host" placeholder="host address" value="" />
																<div class="space-2"></div>
															</div>
														</div>
														<div class="form-group" style="display: none;" id="div_pool_logical">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Device address</strong></label>
															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_spath" placeholder="/dev/sdb1" value="" />
																<div class="space-2"></div>
															</div>
														</div>
														<div class="form-group" style="display: none;" id="div_pool_disk">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Disk path</strong></label>
															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_spath" placeholder="/dev/sdb" value="" />
																<div class="space-2"></div>
															</div>
														</div>
														<div class="form-group" style="display: none;" id="div_pool_iscsi">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>ISCSI path</strong></label>
															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_spath" placeholder="iqn.2013-06.com.example:iscsi-pool" value="" />
																<div class="space-2"></div>
															</div>
														</div>
														<div class="form-group" style="display:none;" id="div_pool_uri">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>URI</strong></label>
															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_spath" placeholder="/uri_path/" value="" />
																<div class="space-2"></div>
															</div>
														</div>
														<div class="form-group" style="display:none;" id="div_pool_spath">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Original path</strong></label>
															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_spath" placeholder="/path/" value="" />
																<div class="space-2"></div>
															</div>
														</div>
														<div class="form-group" id="div_pool_tpath">
															<label class="col-sm-3 control-label no-padding-right" for="form-field-3"><strong>Storage path</strong></label>
															<div class="col-sm-9">
																<input class="input-sm" type="text" name="pool_tpath" placeholder="/path/" value="" />
																<div class="space-2"></div>
															</div>
														</div>
														<div class="space-4"></div>
													</form>


												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-default" data-dismiss="modal">close
													</button>
													<button type="button" class="btn btn-primary" onclick="addVmStorage(this)">
														Add to
													</button>
												</div>
											</div><!-- /.modal-content -->
										</div><!-- /.modal -->
									</div>

{% endblock %}
				</div>
				<div class="ace-settings-container" id="ace-settings-container">
					<div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
						<i class="icon-cog bigger-150"></i>
					</div>

					<div class="ace-settings-box" id="ace-settings-box">
						<div>
							<div class="pull-left">
								<select id="skin-colorpicker" class="hide">
									<option data-skin="default" value="#438EB9">#438EB9</option>
									<option data-skin="skin-1" value="#222A2D">#222A2D</option>
									<option data-skin="skin-2" value="#C6487E">#C6487E</option>
									<option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
								</select>
							</div>
							<span>&nbsp; Select skin</span>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-navbar" />
							<label class="lbl" for="ace-settings-navbar"> Fixed navigation bar</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-sidebar" />
							<label class="lbl" for="ace-settings-sidebar"> Fixed slider</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-breadcrumbs" />
							<label class="lbl" for="ace-settings-breadcrumbs">Fixed bread crumbs</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl" />
							<label class="lbl" for="ace-settings-rtl">Switch to the left</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-add-container" />
							<label class="lbl" for="ace-settings-add-container">
								Switch narrow screen
								<b></b>
							</label>
						</div>
					</div>
				</div><!-- /#ace-settings-container -->
			</div><!-- /.main-container-inner -->

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="icon-double-angle-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->



		<!-- <![endif]-->

		<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

		<!--[if !IE]> -->

		<script type="text/javascript">
			window.jQuery || document.write("<script src='/static/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
			function addVmStorage(obj) {
				var btnObj = $(obj);
					btnObj.attr('disabled',true);
				var server_data = {};
				var form = document.getElementById('addStroage');
				for (var i = 1; i < form.length; ++i) {
					var name = form[i].name;
					var value = form[i].value;
					if ( value.length != 0){
						server_data[name] = value;
					}
				};
				$.ajax({
					dataType: "JSON",
					url:'/addStorage/{{vmServer.id}}/', //Request address
					type:"POST",  //Submit similar
					data:server_data,  //Submit parameters
					success:function(response){
						btnObj.removeAttr('disabled');
						if (response["code"] == 200){
							window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);
						}
						else {
							window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
						}

					},
			    	error:function(response){
			    		window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
			    	}
				})
			}
		</script>

		<script type="text/javascript">
			function getLogsMsg () {
				$.ajax({
					url:'/api/log/{{user}}/', //Request address
					type:"GET",  //Submit similar
					success:function(response){
						if (response.length > 0 ){
								var newStr = '<a data-toggle="dropdown" class="dropdown-toggle" href="#">' +
											 '<i class="icon-bell-alt icon-animated-bell"></i>' +
										     '<span class="badge badge-important">'+ response.length +'</span>' +
										     '</a>' +
											 '<ul class="pull-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">' +
												'<li class="dropdown-header">' +
													'<i class="icon-warning-sign"></i>' + response.length + 'Notice' +
												'</li>'
								for (var i=0;i< response.length;i++)
									{
										if ( response[i]['status'] == 0 ){
											status = '<span class="pull-right badge badge-success">Success</span></div></a></li>'
										}
										else{
											status = '<span class="pull-right badge badge-danger">失败</span></div></a></li>'
										}
										newStr += '<li><a href="javascript:" onclick="readLogsMsg(this,'+  response[i]['id'] + ')"><div class="clearfix">' +
														'<span class="pull-left">' +
														'<i class="btn btn-xs no-hover btn-pink icon-desktop"></i>' + response[i]['content'] +
														'</span>' + status
								};
								newStr +=  '<li> ' +
											 '<a href="/profile/#messages">See all messages' +
											   '<i class="icon-arrow-right"></i>' +
											 '</a>' +
										   '</li>' +
										  '</ul>'
								$('#logMsgs').html(newStr);
							}
					}
				});
			};
			setInterval(getLogsMsg,10000);
			function readLogsMsg(obj,id) {
				$.ajax({
					dataType: "JSON",
					url:'/api/logs/'+ id +'/', //Request address
					type:"PUT",  //Submit similar
					data:{
						'isRead':1,
					}, //Submit parameters
					success:function(response){
						getLogsMsg ();
					}
				})
			}

		</script>

		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='/static/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="/static/js/bootstrap.min.js"></script>
		<script src="/static/js/typeahead-bs2.min.js"></script>

		<!-- page specific plugin scripts -->

		<!-- ace scripts -->

		<script src="/static/js/ace-elements.min.js"></script>
		<script src="/static/js/ace.min.js"></script>

		<!-- inline scripts related to this page -->
		<script src="/static/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script src="/static/js/jquery.ui.touch-punch.min.js"></script>
		<script src="/static/js/chosen.jquery.min.js"></script>
		<script src="/static/js/fuelux/fuelux.spinner.min.js"></script>
		<script src="/static/js/date-time/bootstrap-datepicker.min.js"></script>
		<script src="/static/js/date-time/bootstrap-timepicker.min.js"></script>
		<script src="/static/js/date-time/moment.min.js"></script>
		<script src="/static/js/date-time/daterangepicker.min.js"></script>
		<script src="/static/js/bootstrap-colorpicker.min.js"></script>
		<script src="/static/js/jquery.knob.min.js"></script>
		<script src="/static/js/jquery.autosize.min.js"></script>
		<script src="/static/js/jquery.inputlimiter.1.3.1.min.js"></script>
		<script src="/static/js/jquery.maskedinput.min.js"></script>
		<script src="/static/js/bootstrap-tag.min.js"></script>


</body>
</html>
